<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Brei</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #cccccc; background-color: #303030; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ffcfaf; } /* Alert */
    code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
    code span.at { } /* Attribute */
    code span.bn { color: #dca3a3; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #f0dfaf; } /* ControlFlow */
    code span.ch { color: #dca3a3; } /* Char */
    code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
    code span.co { color: #7f9f7f; } /* Comment */
    code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
    code span.do { color: #7f9f7f; } /* Documentation */
    code span.dt { color: #dfdfbf; } /* DataType */
    code span.dv { color: #dcdccc; } /* DecVal */
    code span.er { color: #c3bf9f; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #c0bed1; } /* Float */
    code span.fu { color: #efef8f; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
    code span.kw { color: #f0dfaf; } /* Keyword */
    code span.op { color: #f0efd0; } /* Operator */
    code span.ot { color: #efef8f; } /* Other */
    code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
    code span.sc { color: #dca3a3; } /* SpecialChar */
    code span.ss { color: #cc9393; } /* SpecialString */
    code span.st { color: #cc9393; } /* String */
    code span.va { } /* Variable */
    code span.vs { color: #cc9393; } /* VerbatimString */
    code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */
  </style>
  <link rel="stylesheet" href="dark.css" />
<script>
// ScrollSpy snippet from Bramus Van Damme (https://www.bram.us/)
// MIT License.
window.addEventListener('DOMContentLoaded', () => {
	const observer = new IntersectionObserver(entries => {
		entries.forEach(entry => {
			const id = entry.target.getAttribute('id');
      const nav = document.querySelector(`nav li a[href="#${id}"]`)
      if (nav) {
        if (entry.intersectionRatio > 0) {
          nav.parentElement.classList.add('active');
        } else {
          nav.parentElement.classList.remove('active');
			} }
		});
	});

	// Track all sections that have an `id` applied
	document.querySelectorAll('section[id]').forEach((section) => {
		observer.observe(section);
	});
});
</script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body class="dark-mode">
<header id="title-block-header">
<div class="row">
<div class="spacing col-3 col-s6">&nbsp;</div>
<div class="col-6 col-s-9">
<h1 class="title">Brei</h1>
<p class="subtitle">a minimal workflow system</p>
</div>
<div class="spacing col-3 col-s3">&nbsp;</div>
</div>
</header>

<div class="row">
<div class="col-3 col-s-6" id="contents"><div class="sticky">
<div class="site-menu">
<ul>
<li><a href="index.html">Home</a></li>
<li><a href="api/brei.html">API documentation (pdoc)</a></li>
<li><a href="implementation.html">Implementation</a></li>
</ul>
</div>
<div class="links">
<ul>
<li><a href="https://entangled.github.io/">Entangled</a></li>
<li><a href="https://github.com/entangled/brei"><img
src="github-mark.svg" /> Github</a></li>
<li><a href="https://esciencecenter.nl"><img src="nlesc.svg" /></a></li>
<li><button onclick="toggleDarkMode()">
Toggle dark mode
</button></li>
</ul>
</div>
<script>
function toggleDarkMode() {
    var element = document.body;
    element.classList.toggle("dark-mode");
}
</script>
</div></div>
<div class="col-6 col-s-9" id="main">
<section id="welcome-to-brei" class="level1">
<h1>Welcome to Brei</h1>
<p>Brei is a small workflow system in Python. The primary reason for
creating Brei is to replace GNU Make, in order to be compatible on
systems that are naturally deprived of this wonder of human ingenuity.
In a nutshell:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode toml"><code class="sourceCode toml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[[</span><span class="dt">task</span><span class="kw">]]</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="dt">description</span> <span class="op">=</span> <span class="st">&quot;Greet the Globe&quot;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="dt">stdout</span> <span class="op">=</span> <span class="st">&quot;hello.txt&quot;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="dt">script</span> <span class="op">=</span> <span class="st">&quot;echo &#39;Hello, World!&#39;&quot;</span></span></code></pre></div>
<ul>
<li>No new syntax: programmable workflows in TOML or JSON files.</li>
<li>Efficient: Runs tasks lazily and in parallel.</li>
<li>Feature complete: Supports templates, variables, includes and
configurable runners.</li>
<li>Few dependencies: Only needs Python ≥3.11.</li>
<li>Small codebase: Brei is around 1000 lines of Python.</li>
</ul>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install brei</span></code></pre></div>
<section id="why" class="level2">
<h2>Why</h2>
<p>Why yet another workflow tool? This tool was developed as part of the
<a href="https://entangled.github.io">Entangled project</a>, but can be
used on its own. Brei is meant to perform small scale automisations for
literate programming in Entangled, like generating figures, and
performing computations locally. It requires no setup to work with and
workflows are easy to understand by novice users. If you have any more
serious needs than that, we’d recommend to use a more tried and proven
system, of which there are too many to count.</p>
</section>
<section id="when-to-use" class="level2">
<h2>When to use</h2>
<p>You’re running a project, there’s lots of odds and ends that need
automisation. You’d use a <code>Makefile</code> but your friend is on
Windows and doesn’t have GNU Make installed. You try to ship a product
that needs this, but don’t want to confront people trying it for the
first time with a tonne of stuff they’ve never heard of.</p>
</section>
</section>
<section id="running" class="level1">
<h1>Running</h1>
<p>Brei is available on PyPI:</p>
<pre><code>pip install brei</code></pre>
<p>Although for Python we recommend using virtual environments, for
example <a href="https://python-poetry.org/">Poetry</a>. Once you’ve
setup a project in Poetry</p>
<pre><code>poetry add brei</code></pre>
<p>Then <code>brei</code> should be available as a command-line
executable.</p>
<div class="doctest" data-status="SUCCESS">
<div class="doctestInput">
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash eval"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">brei</span> <span class="at">--help</span></span></code></pre></div>
</div>
<div class="doctestResult">
<div class="sourceCode" id="cb6"><pre
class="sourceCode txt"><code class="sourceCode default"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>Usage: brei [-h] [-i INPUT_FILE] [-f] [-j JOBS] [-v] [-l] [-d] [targets ...]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>Build one of the configured targets.</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>Positional Arguments:</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  targets               names of tasks to run</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>Options:</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  -h, --help            show this help message and exit</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  -i, --input-file INPUT_FILE</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                        Brei TOML or JSON file, use a `[...]` suffix to</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                        indicate a subsection.</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  -f, --force-run, -B   rebuild all dependencies</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  -j, --jobs JOBS       limit number of concurrent jobs</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  -v, --version         print version number and exit</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  -l, --list-runners    show default configured runners</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  -d, --debug           more verbose logging</span></code></pre></div>
</div>
</div>
</section>
<section id="how-it-works" class="level1">
<h1>How it works</h1>
<p>You give Brei a list of tasks that may depend on one another. Brei
will run these when input files are newer than the target. Execution is
lazy and in parallel.</p>
<section id="tasks" class="level2">
<h2>Tasks</h2>
<p>Tasks are the elemental units of work in Brei. A task is the single
execution of a given script, and can be indicated to depend on previous
tasks by explicitly listing targets and dependencies.</p>
<div class="named-code-block">
<div class="code-block-title">
file:examples/tasks.toml
</div>
<div class="sourceCode" id="cb7"><pre
class="sourceCode toml"><code class="sourceCode toml"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[[</span><span class="dt">task</span><span class="kw">]]</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="dt">creates</span> <span class="op">=</span> <span class="op">[</span><span class="st">&quot;hello.txt&quot;</span><span class="op">]</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="dt">runner</span> <span class="op">=</span> <span class="st">&quot;bash&quot;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="dt">script</span> <span class="op">=</span> <span class="st">&quot;echo &#39;Hello, World!&#39; &gt; hello.txt&quot;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="kw">[[</span><span class="dt">task</span><span class="kw">]]</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">&quot;all&quot;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="dt">requires</span> <span class="op">=</span> <span class="op">[</span><span class="st">&quot;hello.txt&quot;</span><span class="op">]</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="kw">[[</span><span class="dt">task</span><span class="kw">]]</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">&quot;clean&quot;</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="dt">script</span> <span class="op">=</span> <span class="st">&quot;rm hello.txt&quot;</span></span></code></pre></div>
</div>
<p>This defines to named tasks <code>all</code> and <code>clean</code>,
where <code>all</code> depends on the creation of a file
<code>hello.txt</code>. Giving a <code>name</code> to a task is similar
to creating a ‘phony’ target in Make.</p>
</section>
<section id="templates" class="level2">
<h2>Templates</h2>
<p>We can use patterns to create reusable items. Variables follow
Python’s <code>string.Template</code> syntax (similar to many scripting
languages), <code>${var_name}</code> substitutes for the contents of the
<code>var_name</code> variable. Use two dollar signs <code>$$</code> to
make a <code>$</code> literal.</p>
<div class="named-code-block">
<div class="code-block-title">
file:examples/rot13.toml
</div>
<div class="sourceCode" id="cb8"><pre
class="sourceCode toml"><code class="sourceCode toml"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[[</span><span class="dt">task</span><span class="kw">]]</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="dt">description</span> <span class="op">=</span> <span class="st">&quot;Creating temporary directory&quot;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="dt">stdout</span> <span class="op">=</span> <span class="st">&quot;var(dir)&quot;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="dt">script</span> <span class="op">=</span> <span class="st">&quot;mktemp -d&quot;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="kw">[</span><span class="dt">template</span><span class="kw">.</span><span class="dt">echo</span><span class="kw">]</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="dt">stdout</span> <span class="op">=</span> <span class="st">&quot;${stdout}&quot;</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="dt">script</span> <span class="op">=</span> <span class="st">&quot;echo ${text}&quot;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="kw">[</span><span class="dt">template</span><span class="kw">.</span><span class="dt">rot13</span><span class="kw">]</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="dt">stdout</span> <span class="op">=</span> <span class="st">&quot;${stdout}&quot;</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="dt">stdin</span> <span class="op">=</span> <span class="st">&quot;${stdin}&quot;</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="dt">script</span> <span class="op">=</span> <span class="st">&quot;tr a-zA-Z n-za-mN-ZA-M&quot;</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="kw">[[</span><span class="dt">call</span><span class="kw">]]</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="dt">template</span> <span class="op">=</span> <span class="st">&quot;echo&quot;</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">[</span><span class="dt">call</span><span class="kw">.</span><span class="dt">args</span><span class="kw">]</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">stdout</span> <span class="op">=</span> <span class="st">&quot;${dir}/secret.txt&quot;</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">text</span> <span class="op">=</span> <span class="st">&quot;Uryyb, Jbeyq!&quot;</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="kw">[[</span><span class="dt">call</span><span class="kw">]]</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="dt">template</span> <span class="op">=</span> <span class="st">&quot;rot13&quot;</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">[</span><span class="dt">call</span><span class="kw">.</span><span class="dt">args</span><span class="kw">]</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="dt">stdin</span> <span class="op">=</span> <span class="st">&quot;${dir}/secret.txt&quot;</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="dt">stdout</span> <span class="op">=</span> <span class="st">&quot;${dir}/msg.txt&quot;</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="kw">[[</span><span class="dt">task</span><span class="kw">]]</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">&quot;all&quot;</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="dt">requires</span> <span class="op">=</span> <span class="op">[</span><span class="st">&quot;${dir}/msg.txt&quot;</span><span class="op">]</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="dt">script</span> <span class="op">=</span> <span class="st">&quot;cat ${dir}/msg.txt&quot;</span></span></code></pre></div>
</div>
<div class="doctest" data-status="SUCCESS">
<div class="doctestInput">
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash eval"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">brei</span> <span class="at">-i</span> examples/rot13.toml all</span></code></pre></div>
</div>
<div class="doctestResult">
<div class="sourceCode" id="cb10"><pre
class="sourceCode txt"><code class="sourceCode default"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>[17:06:57] INFO     Creating temporary directory                                                                                                                                                                                                  </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>           INFO     creating `/tmp/tmp.ZTAWYafgbK/secret.txt`                                                                                                                                                                                     </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>           INFO     creating `/tmp/tmp.ZTAWYafgbK/msg.txt`                                                                                                                                                                                        </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>           INFO     #all                                                                                                                                                                                                                          </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>Hello, World!</span></code></pre></div>
</div>
</div>
<section id="multiplexing" class="level3">
<h3>Multiplexing</h3>
<p>You can call templates with lists of arguments to create many tasks.
There are two ways to combine multiple arguments: <code>inner</code> and
<code>outer</code>, configured with the <code>join</code> argument. The
<code>inner</code> product uses <code>zip</code> to join the arguments,
while <code>outer</code> uses <code>itertools.product</code> to join.
The default is <code>inner</code>.</p>
<div class="named-code-block">
<div class="code-block-title">
file:examples/template_multiplexing.toml
</div>
<div class="sourceCode" id="cb11"><pre
class="sourceCode toml"><code class="sourceCode toml"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[[</span><span class="dt">task</span><span class="kw">]]</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="dt">description</span> <span class="op">=</span> <span class="st">&quot;Creating temporary directory&quot;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="dt">stdout</span> <span class="op">=</span> <span class="st">&quot;var(dir)&quot;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="dt">script</span> <span class="op">=</span> <span class="st">&quot;mktemp -d&quot;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="kw">[</span><span class="dt">template</span><span class="kw">.</span><span class="dt">touch</span><span class="kw">]</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="dt">description</span> <span class="op">=</span> <span class="st">&quot;${pre} ${a} ${b}&quot;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="dt">creates</span> <span class="op">=</span> <span class="op">[</span><span class="st">&quot;${dir}/${pre}-${a}-${b}&quot;</span><span class="op">]</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="dt">script</span> <span class="op">=</span> <span class="st">&quot;touch &#39;${dir}/${pre}-${a}-${b}&#39;&quot;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="kw">[[</span><span class="dt">call</span><span class="kw">]]</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="dt">template</span> <span class="op">=</span> <span class="st">&quot;touch&quot;</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="dt">collect</span> <span class="op">=</span> <span class="st">&quot;inner&quot;</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">[</span><span class="dt">call</span><span class="kw">.</span><span class="dt">args</span><span class="kw">]</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">pre</span> <span class="op">=</span> <span class="st">&quot;inner&quot;</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">a</span> <span class="op">=</span> <span class="op">[</span><span class="st">&quot;x&quot;</span><span class="op">,</span> <span class="st">&quot;y&quot;</span><span class="op">,</span> <span class="st">&quot;z&quot;</span><span class="op">]</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">b</span> <span class="op">=</span> <span class="op">[</span><span class="st">&quot;1&quot;</span><span class="op">,</span> <span class="st">&quot;2&quot;</span><span class="op">,</span> <span class="st">&quot;3&quot;</span><span class="op">]</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="kw">[[</span><span class="dt">call</span><span class="kw">]]</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="dt">template</span> <span class="op">=</span> <span class="st">&quot;touch&quot;</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="dt">collect</span> <span class="op">=</span> <span class="st">&quot;outer&quot;</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="dt">join</span> <span class="op">=</span> <span class="st">&quot;outer&quot;</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">[</span><span class="dt">call</span><span class="kw">.</span><span class="dt">args</span><span class="kw">]</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  <span class="dt">pre</span> <span class="op">=</span> <span class="st">&quot;outer&quot;</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="dt">a</span> <span class="op">=</span> <span class="op">[</span><span class="st">&quot;x&quot;</span><span class="op">,</span> <span class="st">&quot;y&quot;</span><span class="op">]</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="dt">b</span> <span class="op">=</span> <span class="op">[</span><span class="st">&quot;1&quot;</span><span class="op">,</span> <span class="st">&quot;2&quot;</span><span class="op">]</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="kw">[[</span><span class="dt">task</span><span class="kw">]]</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">&quot;all&quot;</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="dt">requires</span> <span class="op">=</span> <span class="op">[</span><span class="st">&quot;#inner&quot;</span><span class="op">,</span> <span class="st">&quot;#outer&quot;</span><span class="op">]</span></span></code></pre></div>
</div>
<p>The <code>collect</code> argument creates a collection phony task
containing all items in the call.</p>
<div class="doctest" data-status="SUCCESS">
<div class="doctestInput">
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash eval"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">brei</span> <span class="at">-i</span> examples/template_multiplexing.toml all</span></code></pre></div>
</div>
<div class="doctestResult">
<div class="sourceCode" id="cb13"><pre
class="sourceCode txt"><code class="sourceCode default"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>[17:06:58] INFO     Creating temporary directory                                                                                                                                                                                                  </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>           INFO     inner x 1                                                                                                                                                                                                                     </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>           INFO     inner y 2                                                                                                                                                                                                                     </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>           INFO     inner z 3                                                                                                                                                                                                                     </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>           INFO     outer x 1                                                                                                                                                                                                                     </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>           INFO     outer x 2                                                                                                                                                                                                                     </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>           INFO     outer y 1                                                                                                                                                                                                                     </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>           INFO     outer y 2                                                                                                                                                                                                                     </span></code></pre></div>
</div>
</div>
</section>
</section>
<section id="variables" class="level2">
<h2>Variables</h2>
<p>You may write the output of a command to the contents of a variable,
by using <code>"var(name)"</code> as a target. For instance, in many
science applications its desirable to know which version of a software
generated some output.</p>
<div class="named-code-block">
<div class="code-block-title">
file:examples/versioned_output.toml
</div>
<div class="sourceCode" id="cb14"><pre
class="sourceCode toml"><code class="sourceCode toml"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[</span><span class="dt">environment</span><span class="kw">]</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="dt">data_dir</span> <span class="op">=</span> <span class="st">&quot;./data&quot;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="dt">output_dir</span> <span class="op">=</span> <span class="st">&quot;./output/${commit}&quot;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="kw">[[</span><span class="dt">task</span><span class="kw">]]</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="dt">stdout</span> <span class="op">=</span> <span class="st">&quot;var(commit)&quot;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="dt">script</span> <span class="op">=</span> <span class="st">&quot;git rev-parse HEAD&quot;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="kw">[[</span><span class="dt">task</span><span class="kw">]]</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="dt">creates</span> <span class="op">=</span> <span class="op">[</span><span class="st">&quot;${output_dir}/data.h5&quot;</span><span class="op">]</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="dt">requires</span> <span class="op">=</span> <span class="op">[</span><span class="st">&quot;${data_dir}/input.h5&quot;</span><span class="op">,</span> <span class="st">&quot;#prepare&quot;</span><span class="op">]</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="dt">runner</span> <span class="op">=</span> <span class="st">&quot;python&quot;</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="dt">path</span> <span class="op">=</span> <span class="st">&quot;scripts/run.py&quot;</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="kw">[[</span><span class="dt">task</span><span class="kw">]]</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">&quot;prepare&quot;</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="dt">script</span> <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="st">mkdir -p ${output_dir}</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="st">ln -sf ${output_dir} output/latest</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="kw">[[</span><span class="dt">task</span><span class="kw">]]</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">&quot;all&quot;</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="dt">requires</span> <span class="op">=</span> <span class="op">[</span><span class="st">&quot;${output_dir}/data.h5&quot;</span><span class="op">]</span></span></code></pre></div>
</div>
<p>Also note the following:</p>
<ul>
<li>Instead of listing a <code>script</code> you can give a
<code>path</code> to an existing script.</li>
<li>Named (phony) targets are referenced with a hash symbol
<code>#</code>.</li>
<li>Tasks with no targets are always run.</li>
<li>The <code>[environment]</code> item lists global variables.</li>
<li>All string substitution is done lazily.</li>
</ul>
</section>
<section id="includes" class="level2">
<h2>Includes</h2>
<p>You can include parts of a workflow from other files, both TOML and
JSON.</p>
<div class="named-code-block">
<div class="code-block-title">
file:examples/echo.toml
</div>
<div class="sourceCode" id="cb15"><pre
class="sourceCode toml"><code class="sourceCode toml"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[</span><span class="dt">template</span><span class="kw">.</span><span class="dt">echo</span><span class="kw">]</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="dt">stdout</span> <span class="op">=</span> <span class="st">&quot;${stdout}&quot;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="dt">script</span> <span class="op">=</span> <span class="st">&quot;echo &#39;${text}&#39;&quot;</span></span></code></pre></div>
</div>
<div class="named-code-block">
<div class="code-block-title">
file:examples/hello-includes.toml
</div>
<div class="sourceCode" id="cb16"><pre
class="sourceCode toml"><code class="sourceCode toml"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="dt">include</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;./echo.toml&quot;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="op">]</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="kw">[[</span><span class="dt">call</span><span class="kw">]]</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="dt">template</span> <span class="op">=</span> <span class="st">&quot;echo&quot;</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">[</span><span class="dt">call</span><span class="kw">.</span><span class="dt">args</span><span class="kw">]</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">stdout</span> <span class="op">=</span> <span class="st">&quot;hello.txt&quot;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">text</span> <span class="op">=</span> <span class="st">&quot;Hello, World!&quot;</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="kw">[[</span><span class="dt">task</span><span class="kw">]]</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">&quot;all&quot;</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="dt">requires</span> <span class="op">=</span> <span class="op">[</span><span class="st">&quot;hello.txt&quot;</span><span class="op">]</span></span></code></pre></div>
</div>
<p>It is even possible to include files that still need to be generated.
The following generates a file with ten tasks, includes that file and
runs those tasks.</p>
<div class="named-code-block">
<div class="code-block-title">
file:examples/include-gen.toml
</div>
<div class="sourceCode" id="cb17"><pre
class="sourceCode toml"><code class="sourceCode toml"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="dt">include</span> <span class="op">=</span> <span class="op">[</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;${dir}/gen.json&quot;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="op">]</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="kw">[[</span><span class="dt">task</span><span class="kw">]]</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="dt">description</span> <span class="op">=</span> <span class="st">&quot;Creating temporary directory&quot;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="dt">stdout</span> <span class="op">=</span> <span class="st">&quot;var(dir)&quot;</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="dt">script</span> <span class="op">=</span> <span class="st">&quot;mktemp -d&quot;</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="kw">[[</span><span class="dt">task</span><span class="kw">]]</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="dt">description</span> <span class="op">=</span> <span class="st">&quot;Generating workflow&quot;</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="dt">stdout</span> <span class="op">=</span> <span class="st">&quot;${dir}/gen.json&quot;</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="dt">runner</span> <span class="op">=</span> <span class="st">&quot;python&quot;</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="dt">script</span> <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="st">import json</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="st">tasks = [</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="st">    {&quot;stdout&quot;: f&quot;${dir}/out{i}.dat&quot;,</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="st">     &quot;script&quot;: f&quot;echo &#39;{i}&#39;&quot;} for i in range(10)</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="st">]</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="st">tasks.append({&quot;name&quot;: &quot;write-outs&quot;, &quot;requires&quot;: [</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="st">    f&quot;${dir}/out{i}.dat&quot; for i in range(10)</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="st">]})</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="st">print(json.dumps({&quot;task&quot;: tasks}))</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="kw">[[</span><span class="dt">task</span><span class="kw">]]</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">&quot;all&quot;</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="dt">requires</span> <span class="op">=</span> <span class="op">[</span><span class="st">&quot;#write-outs&quot;</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="doctest" data-status="SUCCESS">
<div class="doctestInput">
<div class="sourceCode" id="cb18"><pre
class="sourceCode bash eval"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">brei</span> <span class="at">-i</span> examples/include-gen.toml all</span></code></pre></div>
</div>
<div class="doctestResult">
<div class="sourceCode" id="cb19"><pre
class="sourceCode txt"><code class="sourceCode default"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>[17:06:58] INFO     Creating temporary directory                                                                                                                                                                                                  </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>           INFO     Generating workflow                                                                                                                                                                                                           </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>           INFO     creating `/tmp/tmp.QqYLDRhGEm/out0.dat`                                                                                                                                                                                       </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>           INFO     creating `/tmp/tmp.QqYLDRhGEm/out1.dat`                                                                                                                                                                                       </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>           INFO     creating `/tmp/tmp.QqYLDRhGEm/out2.dat`                                                                                                                                                                                       </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>           INFO     creating `/tmp/tmp.QqYLDRhGEm/out3.dat`                                                                                                                                                                                       </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>[17:06:59] INFO     creating `/tmp/tmp.QqYLDRhGEm/out4.dat`                                                                                                                                                                                       </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>           INFO     creating `/tmp/tmp.QqYLDRhGEm/out5.dat`                                                                                                                                                                                       </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>           INFO     creating `/tmp/tmp.QqYLDRhGEm/out6.dat`                                                                                                                                                                                       </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>           INFO     creating `/tmp/tmp.QqYLDRhGEm/out7.dat`                                                                                                                                                                                       </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>           INFO     creating `/tmp/tmp.QqYLDRhGEm/out8.dat`                                                                                                                                                                                       </span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>           INFO     creating `/tmp/tmp.QqYLDRhGEm/out9.dat`                                                                                                                                                                                       </span></code></pre></div>
</div>
</div>
</section>
<section id="custom-runner" class="level2">
<h2>Custom Runner</h2>
<p>By default, the contents of <code>script</code> is split in lines,
then each line is passed through Python’s <code>shlex.split</code>
function and then run using <code>asyncio.create_subprocess_exec</code>.
What that means is that the script will perform the same operations on
all platforms, and arguments are collected similar to a normal Unix
shell or Windows command prompt. However, you can choose to have the
script run by any other means by providing the <code>runner</code>
argument.</p>
<div class="named-code-block">
<div class="code-block-title">
file:examples/custom-runner.toml
</div>
<div class="sourceCode" id="cb20"><pre
class="sourceCode toml"><code class="sourceCode toml"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[[</span><span class="dt">task</span><span class="kw">]]</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="dt">description</span> <span class="op">=</span> <span class="st">&quot;Creating temporary directory&quot;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="dt">stdout</span> <span class="op">=</span> <span class="st">&quot;var(dir)&quot;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="dt">script</span> <span class="op">=</span> <span class="st">&quot;mktemp -d&quot;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="kw">[</span><span class="dt">runner</span><span class="kw">.</span><span class="dt">lua</span><span class="kw">]</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="dt">command</span> <span class="op">=</span> <span class="st">&quot;lua&quot;</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="dt">args</span> <span class="op">=</span> <span class="op">[</span><span class="st">&quot;${script}&quot;</span><span class="op">]</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="kw">[[</span><span class="dt">task</span><span class="kw">]]</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="dt">runner</span> <span class="op">=</span> <span class="st">&quot;lua&quot;</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="dt">stdout</span> <span class="op">=</span> <span class="st">&quot;${dir}/hello.txt&quot;</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="dt">script</span> <span class="op">=</span> <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="st">function fact (n)</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="st">  if n == 0 then</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="st">    return 1</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="st">  else</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="st">    return n * fact(n-1)</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="st">  end</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="st">end</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="st">print(&quot;10! = &quot;, fact(10))</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="kw">[[</span><span class="dt">task</span><span class="kw">]]</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">&quot;all&quot;</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="dt">requires</span> <span class="op">=</span> <span class="op">[</span><span class="st">&quot;${dir}/hello.txt&quot;</span><span class="op">]</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="dt">script</span> <span class="op">=</span> <span class="st">&quot;cat ${dir}/hello.txt&quot;</span></span></code></pre></div>
</div>
<div class="doctest" data-status="SUCCESS">
<div class="doctestInput">
<div class="sourceCode" id="cb21"><pre
class="sourceCode bash eval"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">brei</span> <span class="at">-i</span> examples/custom-runner.toml all</span></code></pre></div>
</div>
<div class="doctestResult">
<div class="sourceCode" id="cb22"><pre
class="sourceCode txt"><code class="sourceCode default"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>[17:06:59] INFO     Creating temporary directory                                                                                                                                                                                                  </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>           INFO     creating `/tmp/tmp.emJCbpI2Gg/hello.txt`                                                                                                                                                                                      </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>           INFO     #all                                                                                                                                                                                                                          </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>10! = 	3628800</span></code></pre></div>
</div>
</div>
<p>There are a number of runners configured by default.</p>
<div class="doctest" data-status="SUCCESS">
<div class="doctestInput">
<div class="sourceCode" id="cb23"><pre
class="sourceCode bash eval"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">brei</span> <span class="at">--list-runners</span></span></code></pre></div>
</div>
<div class="doctestResult">
<div class="sourceCode" id="cb24"><pre
class="sourceCode txt"><code class="sourceCode default"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>           Default Runners           </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a> runner ┃ executable ┃ arguments     </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a> python │ python     │ [&#39;${script}&#39;] </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a> bash   │ bash       │ [&#39;${script}&#39;] </span></code></pre></div>
</div>
</div>
</section>
<section id="remarks" class="level2">
<h2>Remarks</h2>
<ul>
<li>If you need your workflows also execute on a Windows machine, it is
advised to write scripts for the default runner (lists of commands) or
in Python.</li>
<li>Brei is not meant for building programs, so it doesn’t have the same
feature set as GNU Make. If you need more complex logic, you can write a
Brei generator. The generator creates tasks, writes them to JSON and
then Brei can <code>include</code> the result from your generator
task.</li>
<li>TOML is nice but not ideal: it can be tricky to see the difference
beteween single <code>[...]</code> and double <code>[[...]]</code>
square brackets. Sometimes TOML syntax will lead to very verbose
notation, however, current alternatives are all worse.</li>
<li>Many modern programming languages that we like (Python, Rust, Julia)
have their project settings in a TOML file. This way your Brei workflow
can piggy-back on project files that are already there.</li>
</ul>
</section>
</section>
<section id="license" class="level1">
<h1>License</h1>
<p>Copyright 2023 Netherlands eScience Center, Licensed under the Apache
License, Version 2.0, see <a
href="https://www.apache.org/licenses/LICENSE-2.0">LICENSE</a>.</p>
</section>
</div>

<div id="menu" class="col-3 col-s-3 menu"><nav id="TOC" role="doc-toc">
<ul>
<li><a href="#welcome-to-brei" id="toc-welcome-to-brei">Welcome to
Brei</a>
<ul>
<li><a href="#why" id="toc-why">Why</a></li>
<li><a href="#when-to-use" id="toc-when-to-use">When to use</a></li>
</ul></li>
<li><a href="#running" id="toc-running">Running</a></li>
<li><a href="#how-it-works" id="toc-how-it-works">How it works</a>
<ul>
<li><a href="#tasks" id="toc-tasks">Tasks</a></li>
<li><a href="#templates" id="toc-templates">Templates</a></li>
<li><a href="#variables" id="toc-variables">Variables</a></li>
<li><a href="#includes" id="toc-includes">Includes</a></li>
<li><a href="#custom-runner" id="toc-custom-runner">Custom
Runner</a></li>
<li><a href="#remarks" id="toc-remarks">Remarks</a></li>
</ul></li>
<li><a href="#license" id="toc-license">License</a></li>
</ul>
</nav></div>
</div>

<div class="footer">
</div>

</body>
</html>
